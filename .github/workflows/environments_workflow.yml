name: Pick environment to deploy

on:
  push:
    branches:
      - '*'
jobs:
  trigger_deploy_alpha:
    runs-on: ubuntu-latest
#    if: startsWith(github.event.head_commit.message,'[maven-release-plugin] prepare release') && github.ref == 'refs/heads/develop'
    steps:
      - name: Dispatch deployment workflow for 'Alpha'(development) environment
        id: dispatch_alpha
        uses: benc-uk/workflow-dispatch@v1
        with:
          repo: klevinism/DMS
          ref: ${{ github.ref }}
          token: ${{ secrets.GITSECRET }}
          workflow: deployment_workflow.yaml
          inputs: |
            {
              "environment": "develop",
              "github_destination": "/var/www/dms",
              "app_destination": "/var/www/alphaDCMS",
              "author": "${{ github.actor }}"
            }

  trigger_deploy_beta:
    runs-on: ubuntu-latest
    if: startsWith(github.event.head_commit.message,'[maven-release-plugin] prepare release') && github.ref == 'refs/heads/beta'
    steps:
      - name: Dispatch deployment workflow for 'Beta' environment
        id: dispatch_beta
        uses: benc-uk/workflow-dispatch@v1
        with:
          repo: klevinism/DMS
          ref: beta
          token: ${{ secrets.GITSECRET }}
          workflow: deployment_workflow.yaml
          inputs: |
            {
              "environment": "beta",
              "github_destination": "/var/www/dms",
              "app_destination": "/var/www/betaDCMS"
            }

  trigger_deploy_production:
    runs-on: ubuntu-latest
    if: startsWith(github.event.head_commit.message,'[maven-release-plugin] prepare release') && github.ref == 'refs/heads/master'
    steps:
      - name: Dispatch deployment workflow for 'Production' environment
        id: dispatch_production
        uses: benc-uk/workflow-dispatch@v1
        with:
          repo: klevinism/DMS
          ref: master
          token: ${{ secrets.GITSECRET }}
          workflow: deployment_workflow.yaml
          inputs: |
            {
              "environment": "prod",
              "github_destination": "/var/www/dms",
              "app_destination": "/var/www/prodDCMS"
            }